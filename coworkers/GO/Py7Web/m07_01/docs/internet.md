
#### Как устроен интернет

##### Основные понятия

**Хостинг** — услуга по предоставлению вычислительных мощностей для размещения информации на сервере, постоянно
находящемся
в сети. Хостингом также называется услуга по размещению оборудования клиента на территории провайдера с обеспечением
подключения его к каналам связи с высокой пропускной способностью. Обычно хостинг входит в пакет по обслуживанию сайта и
подразумевает как минимум услугу размещения файлов сайта на сервере, на котором запущено ПО, необходимое для обработки
запросов к этим файлам (веб-сервер). Как правило, в обслуживание уже входит предоставление места для почтовой
корреспонденции, баз данных, DNS, файлового хранилища на специально выделенном файл-сервере и т.п., а также поддержка
функционирования соответствующих сервисов.

**Сервер DNS** — программно-аппаратный комплекс, обеспечивающий трансляцию доменных имен в сетевые адреса (IP-адреса).

![dns](pictures/dns.png)

**Координатор** — уполномоченное юридическое лицо, осуществляющее управление доменами `.ua`.

**Доменное имя** — символьное обозначение, предназначенное для сетевой адресации, в которой используется система
доменных
имен.

**Стоп-лист** — перечень символьных обозначений, регистрация которых в качестве доменных имен недоступна.

**Регистратор** — юридическое лицо, аккредитованное Координатором для регистрации доменных имен в доменах `.ua`

##### Общие сведения

Сервер и браузер общаются, посылая друг другу запросы по особому протоколу – HTTP (RFC-2616). Соединение может
инициировать только браузер. Он посылает серверу запрос — показать такой-то файл.

![http](pictures/http.png)

**HTTP** является синхронным протоколом. Это значит, что клиент послал запрос серверу и пока ждет от него ответ,
следующие
запросы послать не может. Также следует отметить, что **HTTP** — протокол без состояния. Т.е. сервер не сохраняет
информацию
о пользователе между запросами. Для сохранения состояния пользователя в системе используется механизм **cookie** или
сессий.

**Запрос происходит в несколько этапов**:

- *DNS-запрос* — поиск ближайшего DNS-сервера, чтобы преобразовать URI (например, `google.com`) в его числовое
  представление — IP-адрес (`74.125.87.99`, прим. — получено посредством команды `ping`). Это адрес и будет реальным
  адресом сайта в Интернет.
- *соединение* — установка соединения с сервером по полученному IP-адресу;
- *отправка данных*;
- *ожидание ответа* — в этот момент ждем пока пакеты данных дойдут до сервера, он их обработает и ответ вернется назад;
- *получение данных*.

Если какой-то элемент веб страницы размещен на другом хосте, для запроса этого элемента устанавливается новое
соединение, начиная с DNS-запроса.

**Пакеты данных в запросах и ответах между клиентом и сервером содержат HTTP-заголовки. Рассмотрим пример заголовков
запроса:**

```http request
GET /other-19 HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows; U; Windows NT 6.0; ru; rv:1.9.1.5) Gecko/20091102 Firefox/3.5.5 (.NET CLR 3.5.30729)
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: ru,en-us;q=0.7,en;q=0.3
Accept-Encoding: gzip,deflate
Accept-Charset: windows-1251,utf-8;q=0.7,*;q=0.7
Keep-Alive: 300
Connection: keep-alive
```

В первой строке передается информация о методе передачи данных (в данном случае `GET`), затем идет информация о том на
какой ресурс они передаются, который необходимо вернуть `/other-19`, и в конце версия протокола `HTTP/1.1`. На следующее
строке передается информация о хосте, на который передается запрос. Далее в параметре `User-Agent` клиент передает
информацию о браузере. Затем в параметрах `Accept`, `Accept-Language`, `Accept-Encoding`, `Accept-Charset` передается
информация о кодировке, с которой работает браузер, язык по умолчанию для браузера и метод сжатия информации. В конце,
в параметре `Connection`, следует сообщение серверу, что надо открыть постоянное соединение, а в параметре `Keep-Alive`
указываем на сколько (в секундах) мы открываем соединение с сервером.

В свою очередь сервер может отправить ответ со следующими заголовками:

```http request
HTTP/1.1 200 Ok
Server: nginx
Date: Mon, 29 Sep 2014 12:04:19 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
Cache-Control: no-cache,no-store,max-age=0,must-revalidate
Expires: Mon, 29 Sep 2014 12:04:19 GMT
Last-Modified: Mon, 29 Sep 2014 12:04:19 GMT
Content-Encoding: gzip
```

**Ответ сервера состоит из следующих настроек**:

1. В первой строке сервер отдает информацию о версии `HTTP` протокола, статус и описание ответа (все используемые
   статусы
   ответов сервера приведены
   в [здесь](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP)
   .
2. Параметр `Server` говорит о типе сервера.
3. Параметр `Content-Type` – типа отдаваемого содержимого.
4. Параметры `Cache-Control`, `Expires`, `Last-Modified` – отвечают за кэширование ответа сервера.

**Коды состояния ответов сервера**

Часть первой строки ответа сервера при запросах по протоколу `HTTP`. Он представляет собой целое число из трёх
десятичных
цифр. Первая цифра указывает на класс состояния. За кодом ответа обычно следует отделённая пробелом поясняющая фраза на
английском языке, которая разъясняет человеку причину именно такого ответа. Посмотреть, что они значат
можно [здесь](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_%D0%BA%D0%BE%D0%B4%D0%BE%D0%B2_%D1%81%D0%BE%D1%81%D1%82%D0%BE%D1%8F%D0%BD%D0%B8%D1%8F_HTTP)
.
